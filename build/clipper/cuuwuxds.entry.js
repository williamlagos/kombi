const t=window.clipper.h;import"./chunk-c46efb37.js";import{b as e}from"./chunk-b29ff8f0.js";import{d as r,e as o,f as s}from"./chunk-794673eb.js";import{e as i}from"./chunk-3c944ae9.js";import{a as n}from"./chunk-b5dfde61.js";const{Browser:a}=n;class l{constructor(){this.speakers=[],this.orders=[],this.orderNumberStart=0,this.orderNumberEnd=12}async componentWillLoad(){this.store.mapStateToProps(this,t=>{const{session:{token:e}}=t;return{token:e}}),this.role=this.parseJwt(this.token)._role,"MERCHANT"===this.role?(this.store.mapStateToProps(this,t=>{const{merchant:{orders:e}}=t;return{orders:e}}),this.store.mapDispatchToProps(this,{showOrder:i}),await this.showOrder(this.token)):"CUSTOMER"===this.role&&(console.log("YES"),this.store.mapStateToProps(this,t=>{const{customer:{orders:e}}=t;return{orders:e}}),this.store.mapDispatchToProps(this,{showMyOrders:e}),await this.showMyOrders(this.token))}goToSpeakerTwitter(t){console.log("goToSpeakerTwitter",t),a.open({url:`https://twitter.com/${t.twitter}`})}async openSpeakerShare(t){(await this.actionSheetCtrl.create({header:"Share "+t.name,buttons:[{text:"Copy Link",handler:()=>{console.log("Copy link clicked on https://twitter.com/"+t.twitter),window.cordova&&window.cordova.plugins.clipboard&&window.cordova.plugins.clipboard.copy("https://twitter.com/"+t.twitter)}},{text:"Share via ..."},{text:"Cancel",role:"cancel"}]})).present()}async openContact(t){const e=this.mode;(await this.actionSheetCtrl.create({header:"Contact "+t.name,buttons:[{text:`Email ( ${t.email} )`,icon:"ios"!==e?"mail":null,handler:()=>{window.open("mailto:"+t.email)}},{text:`Call ( ${t.phone} )`,icon:"ios"!==e?"call":null,handler:()=>{window.open("tel:"+t.phone)}}]})).present()}parseJwt(t){const e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(window.atob(e))}async offer(t,e){const r=await this.modalCtrl.create({component:"page-order-detail",componentProps:{role:this.role,userId:this.parseJwt(this.token)._id,orderId:t.target.id,order:e}});await r.present();const{data:o}=await r.onDidDismiss();0===o.success&&(t.target.disabled=!0)}previousOrders(){this.orderNumberStart-=12,this.orderNumberEnd-=12}nextOrders(){this.orderNumberStart+=12,this.orderNumberEnd+=12}render(){const e=this.orders.reverse().slice(this.orderNumberStart,this.orderNumberEnd);return[t("ion-header",null,t("ion-toolbar",null,t("ion-buttons",{slot:"start"},t("ion-menu-button",null)),t("ion-title",null,"Ofertar"))),t("ion-content",{class:"outer-content"},t("ion-list",null,t("ion-grid",{fixed:!0},t("ion-row",{"align-items-stretch":!0},this.orders.length>12&&[t("ion-button",{fill:"clear",disabled:0===this.orderNumberStart,onClick:()=>this.previousOrders()},"Anterior"),t("ion-button",{fill:"clear",disabled:this.orderNumberEnd>=this.orders.length,onClick:()=>this.nextOrders()},"Próximo")],e.map(e=>"created"===e.status&&t("ion-col",{size:"12","size-md":"6"},t("ion-card",{class:"speaker-card"},t("a",{style:{"text-decoration":"none"},href:`/speakers/${e.id}`},t("img",{style:{"text-align":"center"},src:e.hasOwnProperty("pictures")&&e.pictures.length>0?e.pictures[0].externalRef:"assets/img/box.svg",alt:"Aqui fica a imagem do pedido"})),t("ion-card-header",null,t("ion-card-subtitle",null,e.job.origin.address.street+", "+e.job.origin.address.number),t("ion-card-title",null,e.title)),t("ion-card-content",null,e.job.origin.items.length>1?t("ion-list",null,e.job.origin.items.map(e=>t("ion-item",null,e.description))):e.job.origin.items.length>0&&e.job.origin.items[0].description),t("ion-button",{id:e._id,expand:"full",color:"primary",disabled:e.placed,fill:"clear",onClick:t=>this.offer(t,e)},"MERCHANT"===this.role?e.placed?"Frete já ofertado":"Ofertar":e.placed?"Frete já selecionado":"Ver ofertas"))))))))]}static get is(){return"page-order-list"}static get properties(){return{actionSheetCtrl:{connect:"ion-action-sheet-controller"},modalCtrl:{connect:"ion-modal-controller"},orderNumberEnd:{state:!0},orderNumberStart:{state:!0},orders:{state:!0},role:{state:!0},store:{context:"store"},token:{state:!0}}}static get style(){return".speaker-card a img{border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-left-radius:0;border-bottom-right-radius:0}"}}class c{create(t){return r(this.doc.createElement("ion-action-sheet"),t)}dismiss(t,e,r){return o(this.doc,t,e,"ion-action-sheet",r)}async getTop(){return s(this.doc,"ion-action-sheet")}static get is(){return"ion-action-sheet-controller"}static get properties(){return{create:{method:!0},dismiss:{method:!0},doc:{context:"document"},getTop:{method:!0}}}}export{l as PageOrderList,c as IonActionSheetController};