import{a as e,b as t}from"./chunk-c46efb37.js";const s=localStorage||window.localStorage;function n(e,t){return new Promise((n,o)=>{try{s&&localStorage.setItem(e,JSON.stringify(t)),n()}catch(e){o(`Couldnt store object ${e}`)}})}function o(e){return new Promise((t,n)=>{try{s&&localStorage.removeItem(e),t()}catch(e){n(`Couldnt remove object ${e}`)}})}function a(e){return new Promise((t,n)=>{try{if(s){const s=localStorage.getItem(e);t(JSON.parse(s))}t(void 0)}catch(e){n(`Couldnt get object: ${e}`)}})}const i="localhost"===(window&&window.location&&window.location.hostname)?"http://localhost:3000":"https://api.shipping.net",r=(s,n)=>async(o,a)=>{if(e.setDomain(i),s.hasOwnProperty("files")){const t=s.files,o=(await(await e.addPicture({xAccessToken:n,files:t})).json()).map(e=>e._id)[0];await e.updateUser({xAccessToken:n,user:Object.assign({},s,{pictures:[o]})})}else await e.updateUser({xAccessToken:n,user:Object.assign({},s)});return o({type:t.UPDATE_PROFILE})},c=s=>async(n,o)=>{e.setDomain(i);const a=await(await e.getUserProfile({xAccessToken:s})).json();return a.pictures=a.hasOwnProperty("pictures")&&a.pictures.length>0?[(await(await e.getPicture({xAccessToken:s,id:a.pictures[0]})).json()).externalRef]:[],n({type:t.OPEN_PROFILE,profile:a})},l=(n,o)=>async(a,r)=>{e.setDomain(i);const c={user:{email:n,password:o}},l=await(await e.authenticateUser(c)).json();return s.setItem("token",String(l.token)),a({directions:{component:"DRAWER",url:"/"},type:t.SET_TOKEN,token:l.token})},p=()=>(e,n)=>(s.removeItem("token"),e({directions:{component:"LOGIN",url:"/login"},type:t.REVOKE_TOKEN,token:""})),u=e=>async(n,o)=>(s.setItem("introduced",String(+e)),n({type:t.SKIP_INTRO,introduced:+e})),d=e=>async(n,o)=>(s.setItem("explained",String(+e)),n({directions:{component:"DRAWER",url:"/"},type:t.SKIP_TOUR,explained:+e})),m=()=>async(e,s)=>e({directions:{component:"REGISTER",url:"/register"},type:t.OPEN_REGISTER,registered:!1}),w=()=>async(e,s)=>e({directions:{component:"LOGIN",url:"/login"},type:t.CLOSE_REGISTER,registered:!0}),y=s=>async(n,o)=>{const a=s.files;console.log(s.files),e.setDomain(i);const r=await(await e.createUser({user:s})).json(),c=(await(await e.addPicture({xAccessToken:r.token,files:a})).json()).map(e=>e._id)[0];return await e.updateUser({xAccessToken:r.token,user:{pictures:[c]}}),n({type:t.CLOSE_REGISTER,registered:!0})},g=(e,s)=>async(n,o)=>{const a=o().session.directions.slice(-1)[0].component;return n({type:t.OPEN,directions:a===e?null:{component:e,url:s}})},E=()=>async(e,s)=>e({type:t.CLOSE,directions:{}});export{E as a,l as b,u as c,m as d,w as e,y as f,n as g,o as h,a as i,g as j,p as k,c as l,s as m,d as n,r as o};