import{a as e,b as t}from"./chunk-c46efb37.js";const s=localStorage||window.localStorage;function o(e,t){return new Promise((o,n)=>{try{s&&localStorage.setItem(e,JSON.stringify(t)),o()}catch(e){n(`Couldnt store object ${e}`)}})}function n(e){return new Promise((t,o)=>{try{s&&localStorage.removeItem(e),t()}catch(e){o(`Couldnt remove object ${e}`)}})}function a(e){return new Promise((t,o)=>{try{if(s){const s=localStorage.getItem(e);t(JSON.parse(s))}t(void 0)}catch(e){o(`Couldnt get object: ${e}`)}})}const r="localhost"===(window&&window.location&&window.location.hostname)?"http://localhost:3000":"https://wasserboxer.herokuapp.com",i=(s,o)=>async(n,a)=>{if(e.setDomain(r),s.hasOwnProperty("files")){const t=s.files,n=(await(await e.addPicture({xAccessToken:o,files:t})).json()).map(e=>e._id)[0];await e.updateUser({xAccessToken:o,user:Object.assign({},s,{pictures:[n]})})}else await e.updateUser({xAccessToken:o,user:Object.assign({},s)});return n({type:t.UPDATE_PROFILE})},c=s=>async(o,n)=>{e.setDomain(r);const a=await(await e.getUserProfile({xAccessToken:s})).json();return a.pictures=a.hasOwnProperty("pictures")&&a.pictures.length>0?[(await(await e.getPicture({xAccessToken:s,id:a.pictures[0]})).json()).externalRef]:[],o({type:t.OPEN_PROFILE,profile:a})},l=(o,n)=>async(a,i)=>{e.setDomain(r);const c={user:{email:o,password:n}},l=await(await e.authenticateUser(c)).json();return s.setItem("token",String(l.token)),a({directions:{component:"DRAWER",url:"/"},type:t.SET_TOKEN,token:l.token})},u=()=>(e,o)=>(s.removeItem("token"),e({directions:{component:"LOGIN",url:"/login"},type:t.REVOKE_TOKEN,token:""})),p=e=>async(o,n)=>(s.setItem("introduced",String(+e)),o({type:t.SKIP_INTRO,introduced:+e})),d=e=>async(o,n)=>(s.setItem("explained",String(+e)),o({directions:{component:"DRAWER",url:"/"},type:t.SKIP_TOUR,explained:+e})),m=()=>async(e,s)=>e({directions:{component:"REGISTER",url:"/register"},type:t.OPEN_REGISTER,registered:!1}),w=()=>async(e,s)=>e({directions:{component:"LOGIN",url:"/login"},type:t.CLOSE_REGISTER,registered:!0}),y=s=>async(o,n)=>{const a=s.files;console.log(s.files),e.setDomain(r);const i=await(await e.createUser({user:s})).json(),c=(await(await e.addPicture({xAccessToken:i.token,files:a})).json()).map(e=>e._id)[0];return await e.updateUser({xAccessToken:i.token,user:{pictures:[c]}}),o({type:t.CLOSE_REGISTER,registered:!0})},g=(e,s)=>async(o,n)=>{const a=n().session.directions.slice(-1)[0].component;return o({type:t.OPEN,directions:a===e?null:{component:e,url:s}})},E=()=>async(e,s)=>e({type:t.CLOSE,directions:{}});export{E as a,l as b,p as c,m as d,w as e,y as f,o as g,n as h,a as i,g as j,u as k,c as l,s as m,d as n,i as o};