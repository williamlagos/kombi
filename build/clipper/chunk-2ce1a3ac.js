import{a as e,b as t}from"./chunk-c46efb37.js";const s,n=localStorage;function o(e,t){return new Promise((n,o)=>{try{s&&localStorage.setItem(e,JSON.stringify(t)),n()}catch(e){o(`Couldnt store object ${e}`)}})}function a(e){return new Promise((t,n)=>{try{s&&localStorage.removeItem(e),t()}catch(e){n(`Couldnt remove object ${e}`)}})}function i(e){return new Promise((t,n)=>{try{if(s){const s=localStorage.getItem(e);t(JSON.parse(s))}t(void 0)}catch(e){n(`Couldnt get object: ${e}`)}})}const r="localhost"===(window&&window.location&&window.location.hostname)?"http://localhost:3000":"https://api.shipping.net",c=(s,n)=>async(o,a)=>{if(e.setDomain(r),s.hasOwnProperty("files")){const t=s.files,o=(await(await e.addPicture({xAccessToken:n,files:t})).json()).map(e=>e._id)[0];await e.updateUser({xAccessToken:n,user:Object.assign({},s,{pictures:[o]})})}else await e.updateUser({xAccessToken:n,user:Object.assign({},s)});return o({type:t.UPDATE_PROFILE})},l=s=>async(n,o)=>{e.setDomain(r);const a=await(await e.getUserProfile({xAccessToken:s})).json();return a.pictures=a.hasOwnProperty("pictures")&&a.pictures.length>0?[(await(await e.getPicture({xAccessToken:s,id:a.pictures[0]})).json()).externalRef]:[],n({type:t.OPEN_PROFILE,profile:a})},p=(n,o)=>async(a,i)=>{e.setDomain(r);const c={user:{email:n,password:o}},l=await(await e.authenticateUser(c)).json();return s.setItem("token",String(l.token)),a({directions:{component:"DRAWER",url:"/"},type:t.SET_TOKEN,token:l.token})},u=()=>(e,n)=>(s.removeItem("token"),e({directions:{component:"LOGIN",url:"/login"},type:t.REVOKE_TOKEN,token:""})),d=e=>async(n,o)=>(s.setItem("introduced",String(+e)),n({type:t.SKIP_INTRO,introduced:+e})),m=e=>async(n,o)=>(s.setItem("explained",String(+e)),n({directions:{component:"DRAWER",url:"/"},type:t.SKIP_TOUR,explained:+e})),w=()=>async(e,s)=>e({directions:{component:"REGISTER",url:"/register"},type:t.OPEN_REGISTER,registered:!1}),y=()=>async(e,s)=>e({directions:{component:"LOGIN",url:"/login"},type:t.CLOSE_REGISTER,registered:!0}),g=s=>async(n,o)=>{const a=s.files;console.log(s.files),e.setDomain(r);const i=await(await e.createUser({user:s})).json(),c=(await(await e.addPicture({xAccessToken:i.token,files:a})).json()).map(e=>e._id)[0];return await e.updateUser({xAccessToken:i.token,user:{pictures:[c]}}),n({type:t.CLOSE_REGISTER,registered:!0})},E=(e,s)=>async(n,o)=>{const a=o().session.directions.slice(-1)[0].component;return n({type:t.OPEN,directions:a===e?null:{component:e,url:s}})},O=()=>async(e,s)=>e({type:t.CLOSE,directions:{}});export{O as a,p as b,d as c,w as d,y as e,g as f,o as g,a as h,i,E as j,u as k,l,n as m,m as n,c as o};