import{r as i,g as t}from"./p-5a3a7011.js";import{C as s,U as o}from"./p-ffa8a7c4.js";import{s as e,b as a,c as r,d as n}from"./p-30d77a1e.js";import{s as l}from"./p-1ebc0f64.js";import{i as c}from"./p-011655de.js";import"./p-65d8e78f.js";const d=class{constructor(t){i(this,t),this.excludeTracks=[],this.dayIndex=0,this.groups=[],this.shownSessions=[],this.segment="awaiting",this.queryText="",this.orders=[],this.scheduleOrders=[],this.awaitingOrders=[],this.slided=!1}async componentWillLoad(){this.updateSchedule(),this.store.mapStateToProps(this,(i=>{const{session:{token:t}}=i;return{token:t}})),this.store.mapDispatchToProps(this,{close:c}),this.role=this.parseJwt(this.token)._role,"MERCHANT"===this.role?(this.store.mapStateToProps(this,(i=>{const{merchant:{orders:t}}=i;return{orders:t}})),this.store.mapDispatchToProps(this,{showMyOrders:e,selectOrder:a,cancelOrder:r,startOrder:n})):"CUSTOMER"===this.role&&(this.store.mapStateToProps(this,(i=>{const{customer:{orders:t}}=i;return{orders:t}})),this.store.mapDispatchToProps(this,{showCustomerOrders:l,cancelOrder:r})),await this.populateOrders()}componentDidLoad(){this.scheduleList=this.el.querySelector("#scheduleList"),this.fab=this.el.querySelector("#socialFab")}async populateOrders(){"MERCHANT"===this.role?await this.showMyOrders(this.token):await this.showCustomerOrders(this.token),this.scheduleOrders=this.orders.filter((i=>"accepted"===i.status)),this.awaitingOrders=this.orders.filter((i=>"awaiting_for_confirmation"===i.status))}parseJwt(i){const t=i.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(window.atob(t))}segmentChanged(i){this.segment=i.target.value,this.updateSchedule()}searchbarChanged(i){this.queryText=i.target.value,console.log(this.queryText),this.updateSchedule()}modalDidDismiss(i){i&&(this.excludeTracks=i.detail.data,this.updateSchedule())}loadingWillDismiss(){this.fab.close()}async updateSchedule(){const i=await s.getTimeline(this.dayIndex,this.queryText,this.excludeTracks,this.segment);this.shownSessions=i.shownSessions,this.groups=i.groups,this.el.forceUpdate()}async presentFilter(){const i=await this.modalCtrl.create({component:"page-schedule-filter",componentProps:{excludedTracks:this.excludeTracks}});await i.present()}async cancelCurrentOrder(i){await this.cancelOrder(i,this.token),await this.populateOrders(),(await this.tab.componentOnReady()).select("tab-drawer"),this.close()}async startCurrentOrder(i){await this.startOrder(i,this.token),(await this.tab.componentOnReady()).select("tab-drawer"),this.close()}async confirmOrder(i){(await this.alertCtrl.create({header:"Confirmar o frete para o horário?",buttons:[{text:"Cancelar",handler:()=>{}},{text:"Confirmar",handler:async()=>{this.selectOrder(i,this.token),await this.populateOrders()}}]})).present()}async removeFavorite(i,t){(await this.alertCtrl.create({header:t,message:"Would you like to remove this session from your favorites?",buttons:[{text:"Cancel",handler:()=>{}},{text:"Remove",handler:()=>{o.removeFavorite(i.name),this.updateSchedule()}}]})).present()}async openSocial(i){this.toggleList();const t=await this.loadingCtrl.create({message:`Posting to ${i}`,duration:1e3*Math.random()+500});await t.present()}toggleList(){const i=this.fab.querySelector("ion-fab-button");i.activated=!i.activated;const t=this.fab.querySelector("ion-fab-list");t.activated=!t.activated}async toggleSlide(i){const t=document.getElementById(i);this.slided?await t.close():await t.open("end"),this.slided=!this.slided}render(){return[h("ion-header",{class:"aligned"},h("ion-toolbar",{class:"aligned"},h("ion-buttons",{slot:"start"},h("ion-menu-button",null)),h("ion-segment",{class:"aligned",value:this.segment},h("ion-segment-button",{value:"awaiting"},"Aguardando"),h("ion-segment-button",{value:"schedule"},"Agendados")),h("ion-buttons",{slot:"end"}))),h("ion-content",null,h("ion-list",{id:"scheduleList",hidden:0===this.shownSessions},("awaiting"===this.segment?this.awaitingOrders:this.scheduleOrders).map((i=>h("ion-item-group",null,h("ion-item-sliding",{class:"item-sliding-track",id:i._id,onClick:()=>this.toggleSlide(i._id)},h("ion-item-options",{side:"start"},"accepted"===i.status&&h("ion-item-option",{color:"danger",onClick:()=>this.cancelCurrentOrder(i._id)},"Cancelar")),h("ion-item",{class:"item-sliding-track-trabalho",href:"#"},h("ion-label",null,h("h3",null,i.job.destination.address.street+" "+i.job.destination.address.number),h("p",null," ",i.job.scheduledTo," - ",i.job.origin.address.street+" "+i.job.origin.address.number))),h("ion-item-options",{side:"end"},"MERCHANT"===this.role&&("awaiting_for_confirmation"===i.status?h("ion-item-option",{color:"favorite",onClick:()=>this.confirmOrder(i._id)},"Confirmar"):h("ion-item-option",{color:"tertiary",onClick:()=>this.startCurrentOrder(i._id)},"Começar")))))))),h("ion-list-header",{hidden:("awaiting"===this.segment?this.awaitingOrders:this.scheduleOrders).length>0},"Não há sessões encontradas"))]}get el(){return t(this)}};d.style=".ion-item-divider.sticky{position:sticky;position:-webkit-sticky;top:0}.item-sliding-track ion-label{border-left:2px solid transparent;padding-left:10px}.item-sliding-track-trabalho ion-label{border-left-color:var(--ion-color-primary)}.item-sliding-track-jantar ion-label{border-left-color:var(--ion-color-angular)}.item-sliding-track-quarto ion-label{border-left-color:var(--ion-color-communication)}.item-sliding-track-cozinha ion-label{border-left-color:var(--ion-color-tooling)}.item-sliding-track-lazer ion-label{border-left-color:var(--ion-color-services)}.item-sliding-track-living ion-label{border-left-color:var(--ion-color-design)}.item-sliding-track-oficina ion-label{border-left-color:var(--ion-color-workshop)}.item-sliding-track-comida ion-label{border-left-color:var(--ion-color-food)}.item-sliding-track-biblioteca ion-label{border-left-color:var(--ion-color-documentation)}.item-sliding-track-comercial ion-label{border-left-color:var(--ion-color-navigation)}.aligned{min-height:56px}";export{d as page_schedule}