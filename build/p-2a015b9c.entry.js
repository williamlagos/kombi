import{r as t,g as i}from"./p-5a3a7011.js";import{C as s}from"./p-ffa8a7c4.js";import{s as o,c as e,r as a,f as n}from"./p-30d77a1e.js";import{s as r}from"./p-1ebc0f64.js";import{a as l}from"./p-011655de.js";import"./p-65d8e78f.js";const c=class{constructor(i){t(this,i),this.gmapKey=process.env.GOOGLE_MAP_KEY,this.orders=[],this.startedOrders=[],this.finishedOrders=[]}async componentWillLoad(){this.mapData=await s.getMap(),this.store.mapStateToProps(this,(t=>{const{session:{token:i,directions:s}}=t;return{token:i,directions:s}})),this.role=this.parseJwt(this.token)._role,"MERCHANT"===this.role?(this.store.mapStateToProps(this,(t=>{const{merchant:{orders:i}}=t;return{orders:i}})),this.store.mapDispatchToProps(this,{open:l,showMyOrders:o,cancelOrder:e,rateOrder:a,finishOrder:n})):"CUSTOMER"===this.role&&(this.store.mapStateToProps(this,(t=>{const{customer:{orders:i}}=t;return{orders:i}})),this.store.mapDispatchToProps(this,{open:l,showCustomerOrders:r,cancelOrder:e,rateOrder:a,finishOrder:n})),await this.populateOrders(),await function(t){const i=window,s=i.google;return s&&s.maps?Promise.resolve(s.maps):new Promise(((s,o)=>{const e=document.createElement("script");e.src=`https://maps.googleapis.com/maps/api/js?key=${t}`,e.async=!0,e.defer=!0,document.body.appendChild(e),e.onload=()=>{const t=i.google;t&&t.maps?s(t.maps):o("google maps not available")}}))}(this.gmapKey)}async componentDidLoad(){await this.populateMap()}async populateMap(){const t=this.mapData,i=this.el.querySelector(".map-canvas"),s=new google.maps.Map(i,{center:this.startedOrders.length>0?this.startedOrders[0].job.origin.address.location:t.find((t=>t.center)),zoom:16});t.forEach((()=>{google.maps.event.addListenerOnce(s,"idle",(()=>{i.classList.add("show-map")}))}))}async componentWillUpdate(){await this.populateOrders(!1)}async populateOrders(t=!0){t&&("MERCHANT"===this.role?await this.showMyOrders(this.token):await this.showCustomerOrders(this.token)),this.startedOrders=this.orders.filter((t=>"started"===t.status)),this.finishedOrders=this.orders.filter((t=>"finished"===t.status&&(t.customerRate<0||t.merchantRate<0))),this.hasOrder=this.startedOrders.length>0,this.hasFinishedOrder=this.finishedOrders.length>0}isEmpty(t){for(const i in t)if(t.hasOwnProperty(i))return!1;return!0}parseJwt(t){const i=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(window.atob(i))}navigate(){const t=this.startedOrders[0].job;window.location.replace(`https://www.google.com/maps/dir/?api=1&travelmode=driving&origin=${t.origin.address.street}, ${t.origin.address.number}&destination=${t.destination.address.street}, ${t.destination.address.number}`)}async cancelCurrentOrder(t){await this.cancelOrder(t,this.token),await this.populateOrders()}async finishCurrentOrder(t){await this.finishOrder(t,this.token),await this.populateOrders()}async rateCurrentOrder(t){await this.rateOrder(t,this.rating,this.token),await this.populateOrders()}toggleStar(t,i){t.preventDefault(),this.rating=+i.split("-")[1],console.log(this.rating);for(let t=1;t<=5;t++)document.getElementById(`star-${t}`).classList.remove("marked");for(let t=1;t<=this.rating;t++)document.getElementById(`star-${t}`).classList.add("marked")}render(){let t="",i="";if(this.hasOrder||this.hasFinishedOrder){const s=this.hasFinishedOrder?this.finishedOrders[0].job:this.startedOrders[0].job;i=`${s.destination.address.street}, ${s.destination.address.number}`,t=`${s.origin.address.street}, ${s.origin.address.number}`}return[h("ion-header",null,h("ion-toolbar",null,h("ion-buttons",{slot:"start"},h("ion-menu-button",null)),h("ion-title",null,"Mapa"))),h("div",{style:this.hasOrder||this.hasFinishedOrder?{display:"none"}:{height:"100%"},class:"map-canvas"}),h("div",{style:{flex:"1",display:"flex","flex-direction":"column"}},(this.hasOrder||this.hasFinishedOrder)&&[h("iframe",{frameborder:"0",style:{border:"0",height:"100%",width:"100%"},src:`https://www.google.com/maps/embed/v1/directions?origin=${t}&destination=${i}&key=${this.gmapKey}`}),h("div",null,h("ion-card",null,h("ion-card-header",null,h("ion-card-subtitle",null,this.hasFinishedOrder?"Avalie seu frete":"Prepare seus itens"),h("ion-card-title",null,this.hasFinishedOrder?"Frete Concluído":"Frete em Andamento")),this.hasOrder&&[h("ion-card-content",null,"O freteiro está a caminho de ",this.startedOrders[0].job.origin.address.street+", "+this.startedOrders[0].job.origin.address.number,", a partir de ",this.startedOrders[0].job.scheduledTo,". Aguarde a chegada do prestador de serviços para começar o frete para o endereço"," "+this.startedOrders[0].job.destination.address.street+", "+this.startedOrders[0].job.destination.address.number,". Contate o"," "+this.startedOrders[0].merchant.name," pelo telefone ",this.startedOrders[0].merchant.phone," ou e-mail ",this.startedOrders[0].merchant.email," em caso de necessidade."),h("div",null,"MERCHANT"===this.role?h("div",{style:{display:"flex",padding:"0px 15px"}},h("ion-button",{style:{flex:"1"},color:"danger",onClick:()=>this.cancelCurrentOrder(this.startedOrders[0]._id)},"Cancelar"),h("ion-button",{style:{flex:"1"},color:"tertiary",onClick:()=>this.navigate()},"Navegar"),h("ion-button",{style:{flex:"1"},color:"success",onClick:()=>this.finishCurrentOrder(this.startedOrders[0]._id)},"Concluir")):h("div",{style:{display:"flex",padding:"0px 15px"}},h("ion-button",{style:{flex:"1"},color:"danger",onClick:()=>this.cancelCurrentOrder(this.startedOrders[0]._id),expand:"block"},"Cancelar"))),h("br",null)],this.hasFinishedOrder&&[h("ion-card-content",null,h("ion-buttons",{class:"stars"},h("ion-button",{id:"star-1",onClick:t=>this.toggleStar(t,"star-1")}),h("ion-button",{id:"star-2",onClick:t=>this.toggleStar(t,"star-2")}),h("ion-button",{id:"star-3",onClick:t=>this.toggleStar(t,"star-3")}),h("ion-button",{id:"star-4",onClick:t=>this.toggleStar(t,"star-4")}),h("ion-button",{id:"star-5",onClick:t=>this.toggleStar(t,"star-5")}))),h("div",{style:{display:"flex",padding:"0px 15px"}},h("ion-button",{style:{flex:"1"},color:"tertiary",onClick:()=>this.rateCurrentOrder(this.finishedOrders[0]._id),expand:"block"},"Enviar")),h("br",null)]))])]}get el(){return i(this)}};c.style=".map-canvas{width:100%;flex:100%;background-color:transparent;opacity:0;transition:opacity 150ms ease-in}.show-map{opacity:1}.stars ion-button{background:gray;-webkit-clip-path:polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);clip-path:polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);height:2.75em !important;width:2.75em !important}.stars ion-button:hover{background:blue}.stars ion-button.marked{background:yellow !important}";export{c as app_map}