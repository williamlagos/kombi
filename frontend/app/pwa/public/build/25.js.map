{"version":3,"sources":["../../src/pages/marketplace/subscription/subscription-information/subscription-information.module.ts","../../src/pages/marketplace/subscription/subscription-information/subscription-information.ts"],"names":[],"mappings":"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","file":"25.js","sourcesContent":["/**\n * @license MIT\n * @version 1.1.0\n * @author M.A.R.S. Labs\n */\n\nimport { NgModule } from \"@angular/core\";\nimport { SubscriptionInformationPage } from \"./subscription-information\";\nimport { IonicPageModule } from \"ionic-angular\";\nimport { ComponentsModule } from \"@components/components.module\";\nimport { DirectivesModule } from \"@directives/directives.module\";\nimport { PipesModule } from \"@pipes/pipes.module\";\n\n@NgModule({\n  declarations: [SubscriptionInformationPage],\n  imports: [\n    IonicPageModule.forChild(SubscriptionInformationPage),\n    ComponentsModule,\n    DirectivesModule,\n    PipesModule\n  ],\n})\nexport class SubscriptionInformationPageModule { }\n\n\n// WEBPACK FOOTER //\n// ./src/pages/marketplace/subscription/subscription-information/subscription-information.module.ts","/**\n * @license MIT\n * @version 1.1.0\n * @author M.A.R.S. Labs\n */\n\nimport { Component, ChangeDetectionStrategy, ChangeDetectorRef, ViewChild } from \"@angular/core\";\nimport { Platform, ModalController, App, NavController, Slides } from \"ionic-angular\";\nimport { IonicPage } from \"ionic-angular\";\n\nimport { AppGlobals } from \"@app/app.globals\";\nimport { AppLocales } from \"@app/app.locales\";\nimport { AppConstants } from \"@app/app.constants\";\nimport { MarsInteractionService } from \"@services/interaction.service\";\nimport { MarsNavigationService } from \"@services/navigation.service\";\nimport { Backend } from \"@backend/index\";\nimport { MarsAuthService } from \"@services/auth.service\";\nimport { CurrencyPipe } from \"@angular/common\";\nimport { MarsCreditCardComponent } from \"@components/mars-credit-card/mars-credit-card\";\nimport { NgForm } from \"@angular/forms\";\nimport { AppUserPages } from \"@pages/user-pages\";\n\n@IonicPage({\n    segment: \"subscription-information\"\n})\n@Component({\n    selector: \"page-subscription-information\",\n    templateUrl: \"subscription-information.html\",\n    changeDetection: ChangeDetectionStrategy.OnPush\n})\n\nexport class SubscriptionInformationPage {\n\n    @ViewChild(\"subscriptionForm\") subscriptionForm: NgForm;\n    @ViewChild(\"slides\") slides: Slides;\n    user: any;\n    plans: Array<any>;\n    navigationService: MarsNavigationService;\n    previousStep: string;\n    nextStep: string;\n    translations: AppTranslations;\n    paymentInstruments: Array<any>;\n    subscriptionPrice: number;\n    token: string;\n    isMerchant: any;\n    currency: CurrencyPipe;\n\n    constructor(private platform: Platform,\n        private app: App,\n        private navCtrl: NavController,\n        private modalCtrl: ModalController,\n        private changeDetector: ChangeDetectorRef,\n        private locales: AppLocales,\n        private globals: AppGlobals,\n        private authService: MarsAuthService,\n        private userInformationPages: AppUserPages,\n        private interactionService: MarsInteractionService) {\n        this.navigationService = new MarsNavigationService(this.app as any);\n        this.navigationService.setNavCtrl(this.navCtrl as any);\n        this.translations = this.locales.load();\n        this.currency = new CurrencyPipe('pt-BR');\n    }\n\n    ionViewWillEnter() {\n        this.init();\n        // In case the user is logged in\n        if (this.authService.isLoggedIn()) this.user = this.authService.getLoggedInUser();\n        // In case the user returned after starting the signup process\n        this.nextStep = this.userInformationPages.getNextStepFor(this.user.roles, \"SubscriptionInformationPage\");\n        this.previousStep = this.userInformationPages.getPreviousStepFor(this.user.roles, \"SubscriptionInformationPage\");\n        if (!this.authService.finishedSignup()) this.user.signupStep = this.nextStep;\n    }\n\n    ionViewDidEnter() {\n        setTimeout(() => { this.changeDetector.detectChanges(); }, 500);\n    }\n\n    async init() {\n        if (MarsAuthService.isLoggedIn()) {\n            this.token = MarsAuthService.getMarsToken();\n            this.isMerchant = MarsAuthService.hasRole('MERCHANT');\n            this.getSubscriptionPlans();\n        }\n    }\n\n    showPrevButton() {\n        return this.slides && !this.slides.isBeginning();\n    }\n\n    slidePrev() {\n        if (this.slides) this.slides.slidePrev();\n        this.changeDetector.detectChanges();\n    }\n\n    showNextButton() {\n        return this.slides && !this.slides.isEnd();\n    }\n\n    slideNext() {\n        if (this.slides) this.slides.slideNext();\n        this.changeDetector.detectChanges();\n    }\n\n    disableSave() {\n        return !this.subscriptionForm.valid;\n    }\n\n    async getSubscriptionPlans() {\n        try {\n            this.plans = (await Backend.getSubscriptionPlans()).data;\n            this.plans.sort((a, b) => { return a.price - b.price; });\n        } catch (e) {\n            this.plans = [];\n            this.interactionService.alert(this.translations.server_failure);\n        }\n        finally {\n            this.changeDetector.detectChanges();\n        }\n    }\n\n    async save(plan) {\n        let spinner = this.interactionService.spinner({ content: `${this.translations.loading}...` });\n        try {\n            this.user.payment = this.user.payment || {};\n            this.user.payment.subscription = this.user.payment.subscription || { plan: {} };\n            this.user.payment.subscription.plan.code = plan.code;\n            let isLoggedIn = this.authService.isLoggedIn();\n            let user = isLoggedIn ? (await Backend.updateUser({ user: this.user, xAccessToken: this.token })).data : (await Backend.createUser({ user: this.user })).data;\n            this.storeDataFor(user);\n            if (this.user.payment.subscription.code) {\n                user.payment.subscription = (await Backend.addSubscription({ subscription: this.user.payment.subscription, xAccessToken: this.token })).data;\n                MarsAuthService.setLoggedInUser(user);\n            }\n            return MarsAuthService.finishedSignup() ? this.navigationService.goBack() : this.navigationService.goTo(this.nextStep);\n        } catch (e) {\n            console.log(e);\n            this.interactionService.alert(this.translations.server_failure);\n        } finally {\n            spinner.dismiss();\n            this.changeDetector.detectChanges();\n        }\n    };\n\n    storeDataFor(user) {\n        MarsAuthService.setLoggedInUser(user);\n        MarsAuthService.setMarsToken(user.token);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/marketplace/subscription/subscription-information/subscription-information.ts"],"sourceRoot":""}