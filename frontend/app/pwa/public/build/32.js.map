{"version":3,"sources":["../../src/pages/marketplace/merchants/search/merchants-search.module.ts","../../src/pages/marketplace/merchants/search/merchants-search.ts"],"names":[],"mappings":"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","file":"32.js","sourcesContent":["/**\r\n * @license MIT\r\n * @version 1.1.0\r\n * @author M.A.R.S. Labs\r\n */\r\n\r\nimport { NgModule } from \"@angular/core\";\r\nimport { MerchantsSearchPage } from \"./merchants-search\";\r\nimport { IonicPageModule } from \"ionic-angular\";\r\nimport { ComponentsModule } from \"@components/components.module\";\r\nimport { DirectivesModule } from \"@directives/directives.module\";\r\nimport { PipesModule } from \"@pipes/pipes.module\";\r\nimport { Ionic2RatingModule } from \"ionic2-rating/dist/ionic2-rating.module\";\r\n\r\n@NgModule({\r\n  declarations: [MerchantsSearchPage],\r\n  imports: [\r\n    IonicPageModule.forChild(MerchantsSearchPage),\r\n    ComponentsModule,\r\n    DirectivesModule,\r\n    PipesModule,\r\n    Ionic2RatingModule\r\n  ],\r\n})\r\nexport class MerchantsSearchPageModule { }\n\n\n// WEBPACK FOOTER //\n// ./src/pages/marketplace/merchants/search/merchants-search.module.ts","/**\r\n * @license MIT\r\n * @version 1.1.0\r\n * @author M.A.R.S. Labs\r\n */\r\n\r\nimport { Component, ChangeDetectionStrategy, ChangeDetectorRef, NgZone, ViewChild, ElementRef } from \"@angular/core\";\r\n\r\nimport { App, NavController, NavParams, Platform, IonicPage } from \"ionic-angular\";\r\n\r\nimport { AppGlobals } from \"@app/app.globals\";\r\nimport { AppLocales } from \"@app/app.locales\";\r\n\r\nimport { MarsCartService } from \"@services/cart.service\";\r\nimport { MarsAuthService } from \"@services/auth.service\";\r\nimport { MarsGeolocationService } from \"@services/geolocation/geolocation.service\";\r\nimport { MarsInteractionService } from \"@services/interaction.service\";\r\nimport { MarsNavigationService } from \"@services/navigation.service\";\r\nimport { MarsNearByService } from \"@services/geolocation/nearby.service\";\r\nimport { MarsPictureService } from \"@services/picture.service\";\r\nimport { MarsAddressAutocompleteDirective } from \"@directives/mars-address-autocomplete\";\r\n\r\n@IonicPage({\r\n    segment: \"partners-search\"\r\n})\r\n@Component({\r\n    selector: \"page-merchants-search\",\r\n    templateUrl: \"merchants-search.html\",\r\n    changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\n\r\nexport class MerchantsSearchPage {\r\n\r\n    @ViewChild('searchbar', { read: ElementRef }) searchbar: ElementRef;\r\n\r\n    navigationService: MarsNavigationService;\r\n    merchants: Array<any>;\r\n    keyword: string;\r\n    segment: string = \"establishments\";\r\n    translations: AppTranslations;\r\n    addressElement: HTMLInputElement = null;\r\n    address = '';\r\n\r\n    constructor(private platform: Platform,\r\n        private app: App,\r\n        private navCtrl: NavController,\r\n        private navParams: NavParams,\r\n        private zone: NgZone,\r\n        private changeDetector: ChangeDetectorRef,\r\n        private locales: AppLocales,\r\n        private geolocationService: MarsGeolocationService,\r\n        private nearbyService: MarsNearByService,\r\n        private globals: AppGlobals,\r\n        private cartService: MarsCartService,\r\n        private interactionService: MarsInteractionService,\r\n        private authService: MarsAuthService,\r\n        private pictureService: MarsPictureService) {\r\n        this.navigationService = new MarsNavigationService(this.app);\r\n        this.navigationService.setNavCtrl(this.navCtrl);\r\n        this.translations = this.locales.load();\r\n        this.keyword = this.navParams.get(\"keyword\") || \"\";\r\n        if (MarsAuthService.isLoggedIn()) this.globals.currentAddress = MarsAuthService.getLoggedInUser().address;\r\n        this.getMerchants();\r\n        if (this.globals.isPlacingOrder) {\r\n            this.navigationService.goTo(\"MerchantDetailsPage\", {\r\n                merchant: this.cartService.get().merchant.username\r\n            });\r\n        }\r\n    }\r\n\r\n    ionViewWillEnter() { }\r\n\r\n    ionViewDidEnter() {\r\n        setTimeout(() => {\r\n            this.changeDetector.detectChanges();\r\n        }, 600);\r\n    }\r\n\r\n    onAddressSelected(address) {\r\n        address.complement = this.globals.currentAddress.complement || \"\";\r\n        if (!address.streetNumber) return this.interactionService.alert(this.translations.whoops_the_address_must_contain_the_street_number);;\r\n        this.globals.currentAddress = address;\r\n        this.changeDetector.detectChanges();\r\n        this.getMerchants();\r\n    }\r\n\r\n\r\n    onSearchInputChange() {\r\n        this.zone.run(() => {\r\n            this.getMerchants();\r\n        });\r\n    }\r\n\r\n    async getMerchants() {\r\n        if (!this.globals.currentAddress.location) return;\r\n        this.zone.run(async () => {\r\n            try {\r\n                let coordinates = { lat: this.globals.currentAddress.location.lat, lng: this.globals.currentAddress.location.lng };\r\n                this.merchants = (await this.nearbyService.getNearbyMerchantsFromServer({ coordinates: coordinates, keyword: this.keyword, types: [\"pet_store\"] }) as any);\r\n                this.merchants.map((merchant) => {\r\n                    let latestPicture = merchant.pictures.length > 0 ? merchant.pictures[merchant.pictures.length - 1] : undefined;\r\n                    merchant.picture = latestPicture ? this.pictureService.getPictureUrlFor({ _id: latestPicture }) : \"assets/images/extras/merchants/default-avatar.jpg\";\r\n                });\r\n                this.changeDetector.detectChanges();\r\n            } catch (e) {\r\n                this.interactionService.alert(this.translations.server_failure);\r\n            } finally {\r\n                this.changeDetector.detectChanges();\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    redirectToMerchantDetailsPageFor(merchant: any) {\r\n        const google = MarsNearByService.GOOGLE_PROVIDER;\r\n        this.navigationService.goTo(\"MerchantDetailsPage\", {\r\n            provider: merchant.provider,\r\n            merchant: merchant.provider == google ? merchant.place_id : merchant.username\r\n        });\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/marketplace/merchants/search/merchants-search.ts"],"sourceRoot":""}