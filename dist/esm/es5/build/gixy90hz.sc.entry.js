import*as tslib_1 from"../polyfills/tslib.js";import{h}from"../clipper.core.js";import"./chunk-c46efb37.js";import{c as showOrderBids,d as selectMerchantForOrder}from"./chunk-b29ff8f0.js";import{a as close}from"./chunk-fe10219c.js";import{h as placeOrder}from"./chunk-3c944ae9.js";var PageOrderDetail=function(){function e(){this.data={value:0,description:""}}return e.prototype.componentWillLoad=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(e){switch(e.label){case 0:return this.store.mapStateToProps(this,function(e){return{token:e.session.token,bids:e.customer.bids}}),this.store.mapDispatchToProps(this,{placeOrder:placeOrder,showOrderBids:showOrderBids,selectMerchantForOrder:selectMerchantForOrder,close:close}),[4,this.showOrderBids(this.token,this.orderId)];case 1:return e.sent(),[2]}})})},e.prototype.dismiss=function(e){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(t){switch(t.label){case 0:return this.el.closest("ion-modal").dismiss(null===e?{success:0}:e),[4,this.tab.componentOnReady()];case 1:return t.sent().select("tab-drawer"),this.close(),[2]}})})},e.prototype.offer=function(){console.log(this.order._id),console.log(this.orderId);var e=Object.assign({},this.data,{user:this.userId});this.placeOrder(e,this.orderId,this.token),this.dismiss({success:0})},e.prototype.schedule=function(){var e=document.querySelector("#merchants");this.selectMerchantForOrder(e.value,this.orderId,this.token),this.dismiss({success:0})},e.prototype.handleInput=function(e){e.preventDefault(),this.data[e.target.name]="description"!==e.target.name?+e.target.value:e.target.value},e.prototype.render=function(){var e=this,t=this.config.get("mode");return[h("ion-header",null,h("ion-toolbar",null,h("ion-buttons",{slot:"md"===t?"end":"start"},h("ion-button",{onClick:function(){return e.dismiss()}},"Cancelar")),h("ion-title",null,this.order.title))),h("ion-content",{class:"outer-content"},h("ion-grid",null,h("ion-row",null,h("ion-col",{style:{"text-align":"center"},"col-10":!0,"push-1":!0,"col-sm-6":!0,"push-sm-3":!0},h("ion-item",null,this.order.hasOwnProperty("pictures")&&this.order.pictures.length>0?h("img",{style:{"text-align":"center",margin:"10px 10px 10px 0px"},src:this.order.pictures[0].externalRef,alt:"Aqui fica a imagem do pedido"}):h("img",{style:{"text-align":"center",margin:"10px 10px 10px 0px"},alt:"Aqui fica a imagem do pedido"}),h("ion-label",{style:{"text-align":"left"}},h("p",null,"Origem: ",this.order.job.origin.address.street+", "+this.order.job.origin.address.number),h("p",null,"Destino: ",this.order.job.destination.address.street+", "+this.order.job.destination.address.number),h("p",null,this.order.job.origin.items.length>1?h("ion-list",null,this.order.job.origin.items.map(function(e){return h("ion-item",null,e.description)})):this.order.job.origin.items.length>0&&this.order.job.origin.items[0].description))))),h("ion-row",null,h("ion-col",null,"MERCHANT"===this.role?h("form",{style:{width:"100%"}},h("ion-item",null,h("ion-label",null,"Média de preço ofertada: ",Math.round(100*(this.bids.length>0?this.bids.reduce(function(e,t){return e.value+t.value})/this.bids.length:0))/100)),h("ion-item",null,h("ion-label",{position:"stacked",color:"primary"},"Digite uma observação"),h("ion-textarea",{name:"description",value:"",onInput:function(t){return e.handleInput(t)}})),h("ion-item",null,h("ion-label",{position:"stacked",color:"primary"},"Digite o valor desejado"),h("ion-input",{name:"value",type:"number",value:"",onInput:function(t){return e.handleInput(t)}})),h("ion-button",{expand:"full",color:"primary",onClick:function(){return e.offer()},fill:"clear"},"Ofertar")):h("ion-list",null,h("ion-radio-group",{id:"merchants"},h("ion-list-header",null,h("ion-label",null,"Selecione a oferta de um freteiro:")),this.bids.map(function(e,t){return h("ion-item",null,h("ion-label",null,e.user.name," ofereceu R$ ",e.value),h("ion-radio",{slot:"start",value:e.user._id,checked:0===t}))})),h("ion-button",{expand:"block",onClick:function(){return e.schedule()}},"Agendar frete"))))))]},Object.defineProperty(e,"is",{get:function(){return"page-order-detail"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{bids:{state:!0},config:{context:"config"},data:{state:!0},el:{elementRef:!0},order:{type:"Any",attr:"order"},orderId:{type:String,attr:"order-id"},role:{type:String,attr:"role"},store:{context:"store"},tab:{connect:"ion-tabs"},token:{state:!0},userId:{type:"Any",attr:"user-id"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"page-order-detail ion-card{text-align:center}page-order-detail img{max-width:140px;margin:0 auto 20px}page-order-detail p{color:#60646b}.outer-content{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}"},enumerable:!0,configurable:!0}),e}();export{PageOrderDetail};