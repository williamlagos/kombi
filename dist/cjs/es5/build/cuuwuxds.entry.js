"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("../polyfills/tslib.js");
var clipper_core_js_1 = require("../clipper.core.js");
require("./chunk-c46efb37.js");
var chunk_b29ff8f0_js_1 = require("./chunk-b29ff8f0.js");
var chunk_794673eb_js_1 = require("./chunk-794673eb.js");
var chunk_3c944ae9_js_1 = require("./chunk-3c944ae9.js");
var chunk_b5dfde61_js_1 = require("./chunk-b5dfde61.js");
var Browser = chunk_b5dfde61_js_1.a.Browser, PageOrderList = function () { function e() { this.speakers = [], this.orders = [], this.orderNumberStart = 0, this.orderNumberEnd = 12; } return e.prototype.componentWillLoad = function () { return tslib_1.__awaiter(this, void 0, void 0, function () { return tslib_1.__generator(this, function (e) { switch (e.label) {
    case 0: return this.store.mapStateToProps(this, function (e) { return { token: e.session.token }; }), this.role = this.parseJwt(this.token)._role, "MERCHANT" !== this.role ? [3, 2] : (this.store.mapStateToProps(this, function (e) { return { orders: e.merchant.orders }; }), this.store.mapDispatchToProps(this, { showOrder: chunk_3c944ae9_js_1.e }), [4, this.showOrder(this.token)]);
    case 1: return e.sent(), [3, 4];
    case 2: return "CUSTOMER" !== this.role ? [3, 4] : (console.log("YES"), this.store.mapStateToProps(this, function (e) { return { orders: e.customer.orders }; }), this.store.mapDispatchToProps(this, { showMyOrders: chunk_b29ff8f0_js_1.b }), [4, this.showMyOrders(this.token)]);
    case 3: e.sent(), e.label = 4;
    case 4: return [2];
} }); }); }, e.prototype.goToSpeakerTwitter = function (e) { console.log("goToSpeakerTwitter", e), Browser.open({ url: "https://twitter.com/" + e.twitter }); }, e.prototype.openSpeakerShare = function (e) { return tslib_1.__awaiter(this, void 0, void 0, function () { return tslib_1.__generator(this, function (t) { switch (t.label) {
    case 0: return [4, this.actionSheetCtrl.create({ header: "Share " + e.name, buttons: [{ text: "Copy Link", handler: function () { console.log("Copy link clicked on https://twitter.com/" + e.twitter), window.cordova && window.cordova.plugins.clipboard && window.cordova.plugins.clipboard.copy("https://twitter.com/" + e.twitter); } }, { text: "Share via ..." }, { text: "Cancel", role: "cancel" }] })];
    case 1: return t.sent().present(), [2];
} }); }); }, e.prototype.openContact = function (e) { return tslib_1.__awaiter(this, void 0, void 0, function () { var t; return tslib_1.__generator(this, function (r) { switch (r.label) {
    case 0: return [4, this.actionSheetCtrl.create({ header: "Contact " + e.name, buttons: [{ text: "Email ( " + e.email + " )", icon: "ios" !== (t = this.mode) ? "mail" : null, handler: function () { window.open("mailto:" + e.email); } }, { text: "Call ( " + e.phone + " )", icon: "ios" !== t ? "call" : null, handler: function () { window.open("tel:" + e.phone); } }] })];
    case 1: return r.sent().present(), [2];
} }); }); }, e.prototype.parseJwt = function (e) { var t = e.split(".")[1].replace(/-/g, "+").replace(/_/g, "/"); return JSON.parse(window.atob(t)); }, e.prototype.offer = function (e, t) { return tslib_1.__awaiter(this, void 0, void 0, function () { var r; return tslib_1.__generator(this, function (o) { switch (o.label) {
    case 0: return [4, this.modalCtrl.create({ component: "page-order-detail", componentProps: { role: this.role, userId: this.parseJwt(this.token)._id, orderId: e.target.id, order: t } })];
    case 1: return [4, (r = o.sent()).present()];
    case 2: return o.sent(), [4, r.onDidDismiss()];
    case 3: return 0 === o.sent().data.success && (e.target.disabled = !0), [2];
} }); }); }, e.prototype.previousOrders = function () { this.orderNumberStart -= 12, this.orderNumberEnd -= 12; }, e.prototype.nextOrders = function () { this.orderNumberStart += 12, this.orderNumberEnd += 12; }, e.prototype.render = function () { var e = this, t = this.orders.reverse().slice(this.orderNumberStart, this.orderNumberEnd); return [clipper_core_js_1.h("ion-header", null, clipper_core_js_1.h("ion-toolbar", null, clipper_core_js_1.h("ion-buttons", { slot: "start" }, clipper_core_js_1.h("ion-menu-button", null)), clipper_core_js_1.h("ion-title", null, "Ofertar"))), clipper_core_js_1.h("ion-content", { class: "outer-content" }, clipper_core_js_1.h("ion-list", null, clipper_core_js_1.h("ion-grid", { fixed: !0 }, clipper_core_js_1.h("ion-row", { "align-items-stretch": !0 }, this.orders.length > 12 && [clipper_core_js_1.h("ion-button", { fill: "clear", disabled: 0 === this.orderNumberStart, onClick: function () { return e.previousOrders(); } }, "Anterior"), clipper_core_js_1.h("ion-button", { fill: "clear", disabled: this.orderNumberEnd >= this.orders.length, onClick: function () { return e.nextOrders(); } }, "Próximo")], t.map(function (t) { return "created" === t.status && clipper_core_js_1.h("ion-col", { size: "12", "size-md": "6" }, clipper_core_js_1.h("ion-card", { class: "speaker-card" }, clipper_core_js_1.h("a", { style: { "text-decoration": "none" }, href: "/speakers/" + t.id }, clipper_core_js_1.h("img", { style: { "text-align": "center" }, src: t.hasOwnProperty("pictures") && t.pictures.length > 0 ? t.pictures[0].externalRef : "assets/img/box.svg", alt: "Aqui fica a imagem do pedido" })), clipper_core_js_1.h("ion-card-header", null, clipper_core_js_1.h("ion-card-subtitle", null, t.job.origin.address.street + ", " + t.job.origin.address.number), clipper_core_js_1.h("ion-card-title", null, t.title)), clipper_core_js_1.h("ion-card-content", null, t.job.origin.items.length > 1 ? clipper_core_js_1.h("ion-list", null, t.job.origin.items.map(function (e) { return clipper_core_js_1.h("ion-item", null, e.description); })) : t.job.origin.items.length > 0 && t.job.origin.items[0].description), clipper_core_js_1.h("ion-button", { id: t._id, expand: "full", color: "primary", disabled: t.placed, fill: "clear", onClick: function (r) { return e.offer(r, t); } }, "MERCHANT" === e.role ? t.placed ? "Frete já ofertado" : "Ofertar" : t.placed ? "Frete já selecionado" : "Ver ofertas"))); })))))]; }, Object.defineProperty(e, "is", { get: function () { return "page-order-list"; }, enumerable: !0, configurable: !0 }), Object.defineProperty(e, "properties", { get: function () { return { actionSheetCtrl: { connect: "ion-action-sheet-controller" }, modalCtrl: { connect: "ion-modal-controller" }, orderNumberEnd: { state: !0 }, orderNumberStart: { state: !0 }, orders: { state: !0 }, role: { state: !0 }, store: { context: "store" }, token: { state: !0 } }; }, enumerable: !0, configurable: !0 }), Object.defineProperty(e, "style", { get: function () { return ".speaker-card a img{border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-left-radius:0;border-bottom-right-radius:0}"; }, enumerable: !0, configurable: !0 }), e; }(), ActionSheetController = function () { function e() { } return e.prototype.create = function (e) { return chunk_794673eb_js_1.d(this.doc.createElement("ion-action-sheet"), e); }, e.prototype.dismiss = function (e, t, r) { return chunk_794673eb_js_1.e(this.doc, e, t, "ion-action-sheet", r); }, e.prototype.getTop = function () { return tslib_1.__awaiter(this, void 0, void 0, function () { return tslib_1.__generator(this, function (e) { return [2, chunk_794673eb_js_1.f(this.doc, "ion-action-sheet")]; }); }); }, Object.defineProperty(e, "is", { get: function () { return "ion-action-sheet-controller"; }, enumerable: !0, configurable: !0 }), Object.defineProperty(e, "properties", { get: function () { return { create: { method: !0 }, dismiss: { method: !0 }, doc: { context: "document" }, getTop: { method: !0 } }; }, enumerable: !0, configurable: !0 }), e; }();
exports.PageOrderList = PageOrderList;
exports.IonActionSheetController = ActionSheetController;
